大家好！我是 Victor Boutté，Wistia 的一名高级软件工程师。

最近，我在佛罗里达州奥兰多当地的一个技术交流会上，做了一场关于“如何通过状态机为智能体（Agentic）解决方案增加确定性”的演讲。

智能体（Agent）这个概念还很新，大家都在摸索最佳实践。所以，我想分享一下我的方法。现在，我会把演讲中的核心内容浓缩成几个短片分享给大家。

那么，什么是智能体（Agent）呢？
简单来说，它有一个公式：
**大语言模型 (LLM) + 记忆 (Memory) + 规划 (Planning) + 工具 (Tools) + 循环 (Loop)**
它会不断重复这个过程，直到判断任务已经完成。

它和工作流（Workflow）有什么不同？
工作流通常是一个或多个大语言模型串联起来，按照预先设定的路径执行任务，比如步骤1、步骤2、步骤3，然后就结束了。
而智能体不仅能循环，更关键的是，它能 *推理* 并决定下一步该走哪条路。

在我看来，智能体就像一个更高级的系统架构，它能调动一群“专家”（也就是不同的工具或子流程），并且有自主权来决定自己的执行路径。
**你可以把智能体本身看作一个状态机。**

举个例子：一个健身打卡智能体
比如，我正在做一个“健身打卡智能体”，用来帮我和朋友们通过发短信的方式追踪健身进度。我们希望交互尽可能简单——发个短信就行，但智能体背后要有强大的推理能力。它需要能判断用户发来的信息是什么意思：是想记录正在进行的锻炼？还是想补录昨天的锻炼？或者只是问个普通问题？

状态机是如何工作的呢？
一开始，系统处于 `空闲 (idle)` 状态。
当用户提交信息时（比如发了条短信，我们称之为 `user.submit` 事件），系统就进入了 `评估 (evaluating)` 状态。
在 `评估` 状态下，智能体可以根据情况决定下一步怎么走，比如它可以调用三个不同的“专家”，触发不同的事件：
*   `agent.askForClarification` (如果信息不明确，请求用户澄清)
*   `agent.startPlanning` (如果信息明确，开始规划任务)
*   `agent.complete` (如果任务已经完成)

举个例子，如果用户发来的信息很模糊，评估后智能体就会触发 `agent.askForClarification` 事件，进入 `澄清 (clarifying)` 状态。
在 `澄清` 状态下，系统只是等待用户提供更多信息，这里通常不需要复杂的 LLM 专家介入。
用户回复并澄清后，系统会再次回到 `评估` 状态。
这时，如果 `评估` 状态认为信息已经足够清晰，就会触发 `agent.startPlanning` 事件，进入 `规划 (planning)` 状态。
在 `规划` 状态，智能体会制定详细的执行步骤。比如，它可能会规划出：“任务一：记录今天的锻炼”，“任务二：补录昨天跑的5公里”等等。这个规划好的步骤列表会储存在智能体的“记忆”中，作为当前状态的上下文信息。

还记得我们之前说的智能体公式吗？LLM 就是这里的“专家”，记忆就是状态的上下文，工具就是这些不同的专家模块，而整个状态机的运转就是那个“循环”。

规划完成后，智能体就开始按计划执行：
*   比如，执行“任务一：记录今天的锻炼”，系统会进入 `记录当前锻炼 (loggingActiveWorkout)` 的具体状态去处理。
*   这个小任务完成后，它会发送一个事件，比如“当前锻炼记录完毕”，然后又回到 `评估` 状态。
*   `评估` 状态会再次检查整体计划：“所有任务都完成了吗？”哦，还没有，还需要补录昨天的跑步记录。
*   于是，系统可能再次进入 `规划` 状态（或者直接根据已有规划行动），规划说：“好的，现在该调用‘补录专家’了。”
*   接着，它发送一个事件，让系统进入 `补录锻炼条目 (backfillingWorkoutEntry)` 状态去执行补录操作。
*   当补录也完成后，再次发送事件回到 `评估` 状态。
*   这次，`评估` 状态一看计划：“太棒了，所有任务都搞定了！”于是触发 `agent.complete` 事件，整个流程就进入了 `完成 (complete)` 状态。

这种用状态机来构建智能体有什么好处呢？
首先，**你可以为每个“专家”（也就是每个具体的状态或任务）灵活地替换和选择不同的大语言模型。**比如，有些简单任务，你用个快速、便宜的模型就行；而那些需要复杂推理的规划或评估环节，你就可以用更强大、但可能也更贵的模型。这样一来，你就不用被一个“万能”但可能处处不精的顶级模型给束缚住了。

其次，**你可以为每个专家设计更精细、更有针对性的评估逻辑和测试。**

更妙的是，**整个系统因此具备了某种程度的“自学习”能力。**通过记录和分析历史执行路径和结果，智能体可以积累经验。比如它可能会发现：“上次遇到类似情况，我选了B方案，结果不太好；这次我应该试试A方案。”

总结一下
总而言之，用状态机来设计和实现智能体是一种非常强大和灵活的抽象方法。我对此非常着迷，也很兴奋能继续探索下去，并把后续的进展分享给大家。

如果大家感兴趣，欢迎订阅我的频道，关注后续更多内容！
