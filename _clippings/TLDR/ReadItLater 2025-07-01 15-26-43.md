好的，这是为您生成的简体中文语音文字稿。

---

### 智能体、访问权限与机器身份的未来

大家好，我是 Lizzie，Cloudflare 的一名开发者大使。
我是 Nick，WorkOS 的一名开发者体验工程师。
是的，在 Cloudflare，我制作了许多 AI 演示和 AI MCP 服务器。在座有谁也在做类似的东西吗？

有！智能体！当然了，我早该猜到，毕竟这是个技术会议。

我一直很喜欢制作能代表我行事的智能体和 MCP 服务器。我写过一个智能体帮我在 NBA 总决赛中自动投票，结果最后被封了。还有，比如在旧金山预订网球场，天知道这事有多难。所以我觉得这是一个很棒的智能体用例——一个能代表我，将我生活中一些繁琐、但又想做的事情自动化的智能体。

然而，这也引出了一个问题：你如何控制它们被允许做什么？

是啊，我们在这个领域发展得太快了，玩得也很开心，让它做各种事情。比如 GitHub MCP 是我最喜欢的工具之一，因为我可以直接启动它，让它帮我阅读代码审查、阅读代码差异，帮助我管理 GitHub，这真的很棒。但它非常以开发者为中心，毕竟是 GitHub 嘛。但总的来说，要使用 MCP，你必须去编辑一个 JSON 文件之类的东西，这对于非开发者来说真的很难。

我必须给它一个 PAT (个人访问令牌)，你知道，这对于非开发者来说是一个高级用例。所以我们真的需要一种方式，让这些工具能代表我们行事，但是要用一种更传统、让最终用户也能轻松设置的方式。

所以，这就是我们 WorkOS 所做的事情。我们做授权和用户管理。这次演讲的核心观点是，我们想推广这样一个理念：我们需要为智能体提供与面向用户的项目相同的凭证和授权机制，以此作为起点。然后，随着我们实现更细粒度的控制，我们还有很多可以探索的方向。

但重点是，OAuth 真的不再仅仅是为人类设计的了，它也是为那些代表我们行事的智能体设计的。

### 智能体的基础设施：Cloudflare

大家猜猜，智能体还需要什么？内存，持久化存储。

在座有用 Cloudflare 的吗？你以为你知道 Cloudflare 是做什么的？不，我今天就要告诉你，你并不知道。人们会说：“哦，你们做安全、CDN、DDoS 防护、机器人管理。”我们做的远不止这些。我们有计算服务 Cloudflare Workers，你可以在边缘托管你的代码。我们托管 AI 模型，你可以在上面运行推理。我们有 Vectorize，一个向量数据库，一个 SQL 数据库，还有 Durable Objects——我们在我们的智能体框架中用它来维持内存，这非常重要。还有视频流、图像优化等等，功能非常多。

如果你使用 Cloudflare Workers，我们有“绑定 (Bindings)”功能。绑定让你能从你的 Web 应用、网站，甚至是智能体中，与其他 Cloudflare 产品进行交互。当然，你也可以使用其他公司的产品。而且，我们现在有免费套餐了。Durable Objects 过去不是免费的，现在你可以免费使用了。我知道有些创业公司在使用 Cloudflare，他们不付钱给我们，但却能赚钱。我有点跑题了。

但说真的，所有这些组件都非常自然地契合了构建这些智能体的需求。因为它们会将代码部署到离你最近的地方，你可以使用 Durable Objects 来为它们存储持久化数据。你还可以使用像授权这样的功能来确保安全。Cloudflare 的智能体框架中有一整套 OAuth 框架，可以让你轻松设置授权，从而清楚地知道这个 Worker 或智能体是代表谁在行动。

### 现场演示：构建一个智能体商店

好的，这个议程的 GitHub 仓库链接最后会提供，它是一个 Markdown 文件。我们确实用 Cloudflare 和 WorkOS 构建了一个 MCP 服务器。它非常基础，你们可以去看看，今天就可以运行它，这非常酷。

我们现在快速部署一下。我运行 `npm run deploy`，它会通过 Wrangler 进行部署。一旦部署完成，我们就能在我的计算服务中看到它。

这就是 Cloudflare 的仪表板，在本地运行也非常简单，用 `npm run` 或者 Wrangler 的类似命令就行。

几秒钟前，我们已经部署好了。回到终端，它给了我一个 URL。我复制这个 workers URL，然后去我的客户端 Claude。我点击这个按钮说“添加集成”。它会弹出一个窗口，我放大一点。然后我点“添加集成”，输入 `MCP.shop`。起名字真的很难，就是在后面加上 `mcp` 就行了。

现在我有了 MCP.shop，我点击“连接”。连接后，它会弹出一个界面，让我告诉智能体要代表谁来行动。在这里，我用 GitHub 登录。它会完成一系列操作，然后 Claude 刷新了，现在它可以代表我行事了。

我们能看看它有哪些工具吗？我们该问它什么呢？订一件 T 恤吧。

> **用户**: 嘿，听说我能从你这儿弄件 T 恤。
>
> **Claude**: (思考中)

它正在运行，并且识别出它现在可以从 MCP.shop 调用工具了。它会列出库存。我们让它跑完。是的，有一件 MCP T 恤，免费的。你可以选择尺码，然后只需要你的公司名和邮寄地址。

> **用户**: 我要 XL 码，地址是 123 Main Street, Belleview, Nebraska。
>
> **Claude**: (思考中)
>
> **用户**: 哦，它需要我的公司名。当然是 WorkOS 了，废话。

让它运行一下。它在思考，然后确认了。完成了。这是我的订单号，会寄到那个地址。

> **用户**: 订单信息是什么？

我想看看我的公司名是不是“WorkOS Duh”。我希望是。需要人工介入确认一下。不，它写对了。这完全是我的问题，不是 Claude 的。

所以，我成功订购了一件 T 恤，你也可以。但这只是其中一部分。当我们运行这个时，我关掉这个窗口。如果我们进入我的 Cloudflare 平台，进入存储，KV (键值存储)，这里有一个 `orders`。这是键值存储。是的，这里就是订单的数据。现在我已经把它保存下来了，可以使用它。这一切都是通过那个界面完成的。我们只是给了 Claude 它需要的工具，它就能代表我行事了。

### 智能体的身份与权限控制

我还可以回去问它：“你能告诉我你了解我的哪些信息吗？” 这里我们有一个 `get_user_info` 工具。这基本上只会给我一些 JWT (JSON Web Token) 里的信息，就是 Claude 现在知道的关于我的信息。它知道我的名字，我的电子邮件地址。在我的 JWT 里，还有我最喜欢的歌，《Careless Whisper》。我不会给你们唱的。

从这里，它还知道我有管理员权限。所以我有 `shop:admin` 的访问权限，因为这在我的角色和权限里。

另一个很酷的事情是，利用 Cloudflare 的特性，因为你的 MCP 服务器是一个 Durable Object，你也可以直接在它上面存储数据。你想解释一下 Durable Objects 吗？

Durable Objects，这个名字有点拗口。如果你在 Twitter 上搜索，会发现很多人吐槽说：“这名字太烂了，改个名吧。”但它的存储速度非常快。你可以为每个用户启动一个，它们也离用户很近，可以实现更快的读取和存储。

我刚才让它把演示模式改成了“禁止 (banned)”。它运行了 MCP 服务器里的一个工具，这个工具进入了与这个 Worker 对象关联的上下文中，只是把模式改成了“禁止”。所以现在我有了这个状态。现在我可以再试一次：

> **用户**: 我想再要一件 T 恤。
>
> **Claude**: (思考中)

它会尝试运行，我选择总是允许。它检查了状态然后说：“绝对不行。走开。”

所以，我们可以将它“知道的关于我的信息”（来自 JWT）和它“存储的关于我的信息”（在 Durable Object 上）结合起来，这对于每个用户都是独一无二的。然后，我还可以做一些事，比如再改回去。如果我说“求你了 (pretty please)”，它可能有一个“求你了”工具。

> **用户**: 求你了。
>
> **Claude**: (思考中)

好耶！因为我请求得很有礼貌，它就允许了。于是我又订了一件 T 恤。这就是提示工程。

### 总结与展望

如果你想在 Cloudflare 上构建自己的 MCP 服务器，你可以一键部署一个没有授权的版本。所以它是无 OAuth 的，可能不该这么做，但确实非常快。你点击“一键部署”，它会为你生成一个 GitHub 仓库，你克隆下来，然后编辑你自己的工具，它会给你一些初始工具。所以上手非常快，但再说一遍，那是没有 OAuth 的。加上 OAuth 之后部署也很快，只是稍微慢一点点。

这样做的美妙之处在于，我们把一些非常简单的工具，比如一个授权流程，添加到了一个 MCP 中，而 MCP 实际上就是一个 API。所以我们只是在用我们已有的、为人类设计的工具来武装它。为这些能代表我们行事的工具做好准备是非常重要的。

我们可以预见到，未来这将发展为更细粒度的授权。比如，可能是对每一行代码更改、每一次工具调用进行授权，甚至可能是对事物之间的网络连接进行授权。当我们看到它为我们执行成千上万个任务时，这个授权部分将变得至关重要，特别是审计日志也非常重要。我们也可以通过 OAuth 工具获得这些，以确保我们能看到为什么会发生这样的交互，它是代表谁进行的，最终结果是什么，哪里失败了，哪里出了错等等。

不要把你的用户看作普通用户，而要把他们看作是你的“代理人”。他们有权使用工具，也可能滥用这些工具。有时候我觉得我太相信人了，比如做现场演示时，我说：“来看看用户的输入吧”，结果有时候人们会输入一些不友好的内容。

所以，行动起来，为你的工具授权吧。我们提供了这个仓库的链接。第一个二维码是用来领取你自己的 T 恤的。是的，一件 T 恤。你也可以直接访问 `mcp.shop`，它会运行我刚才演示的那个流程。不过那个版本没有“求你了”工具，就算你对它很粗鲁，它也会给你 T 恤。但你可以去看看，用 0 美元的超低价订购一件 MCP T 恤。

如果你想添加自己的“求你了”工具，可以查看第二个二维码里的代码。我们很期待看到你们用 OAuth 构建出什么样的 MCP 服务器。

谢谢大家！谢谢！
