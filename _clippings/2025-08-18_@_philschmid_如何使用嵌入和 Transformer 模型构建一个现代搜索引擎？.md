---
title: "如何使用嵌入和 Transformer 模型构建一个现代搜索引擎？"
source: "https://x.com/_philschmid/status/1956981442870751289"
author:
  - "[[@_philschmid]]"
published: 2025-08-18
created: 2025-08-18
description:
tags:
  - "@_philschmid #搜索引擎 #嵌入 #Transformer"
---
**Philipp Schmid** @\_philschmid [2025-08-17](https://x.com/_philschmid/status/1956981442870751289)

  
你如何使用嵌入和 Transformer 模型构建一个现代搜索引擎？这里有一篇关于@wilsonzlin 如何在两个月内构建一个网络搜索引擎的文章，该引擎能够用 30 亿个嵌入对 2.8 亿个网页进行索引。

摄取过程（简化版）：

1\. 抓取原始 HTML 页面并进行规范化处理，以提取仅其核心语义文本内容，去除菜单、页脚、广告和其他非内容“修饰元素”。

2\. 被拆分成一个个句子，这些句子作为搜索结果的原子单元。

3\. 不是孤立地对一个句子进行嵌入，而是通过组合文档结构中的结构上下文（例如页面标题、章节标题（## 等）以及该句子所属的表格标题）为其构建丰富的上下文。一个经过定制训练的 DistilBERT 模型分析前面的句子，以确定哪些句子对于理解目标句子是必要的（例如解析像“it”或“this”这样的代词）。这些相关句子被添加到前面。

经验教训：

\- 将内容分块成句子是比固定大小的块更有效的原子单元。

\- 通过在前面添加 HTML 结构（标题、表格数据）来保留上下文可提高性能

\- 上下文保留对于回答复杂的非关键词查询至关重要。

\- 内容过滤和质量判定是最关键的挑战。

\- 无法充分爬取网络；索引规模（“数量”）是一种质量形式。

\- PostgreSQL 作为高吞吐量数据库失败了，迁移到了分片的 RocksDB 实现。

\- RocksDB 的 BlobDB 功能被用于高效存储大量页面内容，而不会影响性能。

\- 相较于昂贵的 API，选择在性价比高的 Runpod GPU 上进行自托管推理。

\- 使用了自定义的基于磁盘的向量数据库（CoreNN）来解决 HNSW 的内存成本问题。

\- 构建了一个基于 RocksDB 的自定义队列，其每秒可实现 30 万次操作，性能远超 SQS。

没有谈到重点

\- 一种用于更新或删除内容的策略，这会使索引很快过时。

\- 如何根据用户位置、语言或上下文对结果进行个性化设置。

\- 当前的扩展限制，不确定能否从2.8亿网页扩展到数千亿（成本、基础设施等方面）

![Image](https://pbs.twimg.com/media/GyiX1XaWwAAI2BV?format=jpg&name=large)