---
title: "How to create common architecture diagrams with the C4 model"
source: "https://icepanel.medium.com/how-to-create-common-architecture-diagrams-with-the-c4-model-77c595945486"
author:
  - "[[IcePanel]]"
published: 2025-01-31
created: 2025-03-31
description: "The C4 model is a lightweight and flexible framework for representing a variety of software architecture patterns, such as microservices, monoliths, event-driven, or domain-driven design. In this…"
tags:
  - "clippings"
---
## ⚡ 简而言之

- 单体应用被建模为单个“大型”可部署应用，并存储在第 2 层。
- 微服务在第 2 层中被建模为 API 服务和数据库对。
- 基于事件的实体（如队列和主题）可以建模为二级容器（应用程序/存储），或作为连接上的技术选择。
- 诸如领域、子领域和有界上下文等领域驱动设计概念可以在 IcePanel 中使用视图、领域和组的组合来表示。

## 介绍

C4 模型是一个轻量级且灵活的框架，用于表示各种软件架构模式，如微服务、单体架构、事件驱动或领域驱动设计。在本指南中，我们将探讨一些核心模式以及如何在 IcePanel 中对它们进行建模。让我们开始吧！

## 单体应用程序

一个传统的单体应用程序在一个单元中包含业务逻辑、接口和数据库。单体应用程序作为一个大型代码库进行部署和维护。要在 C4 模型中表示这一点，在第 2 层中将单体应用程序显示为单个应用程序和数据库。请记住，在 C4 模型中，容器被定义为一个可单独部署/运行的对象——单体应用程序就是可部署单元。为了解释单体应用程序的内部组件，在第 3 层放大应用程序以定义不同的模块或控制器。

在这个例子中，我们有一个单体电子商务应用程序。一级图包含一个代表电子商务平台（在线精品店）的系统。在二级，我们有一个用于单体应用程序的单个应用和一个数据库存储。在（应用程序的）三级，我们将其分解以展示不同的组件。

## 第 1 级 — 上下文关系图

1 级图表 — 单体电子商务应用程序

## 2 级 —— 应用程序/容器图

二级图表 — 单体电子商务应用程序

## 三级 — 组件图

三级图表 —— 单体电子商务应用程序

## 微服务

在微服务架构中，应用程序被划分为独立的、可单独部署的服务，这些服务专注于不同的业务能力。这些服务拥有各自独立的代码库，并通过 API 相互通信。

要在 IcePanel 中对此进行建模，请将微服务显示为 API 的应用程序和数据库的存储。如果你想更明确地说明 API 和存储的配对，请创建一个组并将容器分配给它。

回到我们的示例，在第 1 层中，我们将电子商务平台显示为一个单一系统，就像在单体示例中一样。但是，现在第 2 层图将为每个微服务包含一组应用程序和商店。可以选择添加组来清晰显示微服务对。

## 第 1 级 —— 上下文关系图（与单体示例相同）

1 级图 — 微服务电子商务应用程序

## 2 级 —— 应用程序/容器图

二级图表 — 微服务电子商务应用程序

## 事件驱动

基于消息的队列和主题通信已成为一种流行的架构模式，用于使解耦系统能够大规模地相互通信。在 IcePanel 中有两种推荐的方法来对此进行建模。

## 二级中的队列或主题作为应用程序

将各个队列或主题表示为具有与其他对象的输入和输出连接的应用程序。你也可以将它们表示为存储（只需确保在使用中保持一致）。避免对单个消息总线进行建模，这可能会导致“中心辐射型”设计。这会隐藏发送方和接收方对象之间的潜在关系。

在第 2 级中将主题表示为应用程序的示例

## 连接上的队列/主题

或者，将队列或主题表示为连接之上的一种技术选择。这种方法会生成一个更清晰的图，但会模糊传输信息。这样做没有对错之分，但在方法上要保持一致。

## 领域驱动设计

领域驱动设计（DDD）专注于基于业务目标和客户问题对软件进行建模。其目标是使代码和架构与业务流程保持一致。

关于领域驱动设计（DDD）有大量的资源，所以我们不会详细探讨相关文献，但需要考虑的关键概念是领域、子领域和有界上下文。最好将这些视为 C4 模型中的组织架构，而非抽象概念。避免试图将 DDD 硬套进 C4 模型的抽象概念中——它们是用于不同目的的不同方法。

这些关键的领域驱动概念可以映射到 IcePanel：

- 领域驱动设计中的领域如同 IcePanel 中的景观
- 作为 IcePanel 中的领域的 DDD 中的子领域
- 作为 IcePanel 中分组的有界上下文

回到我们的电子商务示例，IcePanel 全景可以被视为（在领域驱动设计中）代表正在解决的核心问题——“在线购物”的领域。IcePanel 中的领域可用于表示领域驱动设计中的不同子领域，例如“库存管理”、“订单履行”、“结账”、“支付处理”等。最后，组可以表示每个领域（领域驱动设计中的子领域）内的有界上下文区域。

![](https://miro.medium.com/v2/resize:fit:1312/1*HUKg90qp06t0FZIu5TaerQ.png)

## 用于有界上下文的带有“运输”组的二级图

将有界上下文作为一个组的二级图

另一种选择是使用标签来表示这些概念。为有界上下文选项创建一个标签组，并通过多选来快速为对象分配标签。

## 带有“运输”标签的二级图，用于有界上下文

带有有界上下文作为标签的二级图

## 🏁 最后的想法

C4 模型定义了一个简单的标准，用于对软件架构进行建模，具有足够的灵活性来表示不同的架构模式。如果你是 C4 模型的新手，或者正在从 UML 等其他方法过渡过来，那么你需要在思维上做出一点转变，以适应你可能已经习惯的方式。这些改变旨在帮助你在整个团队中一致地对关键模式进行建模。如果你还有其他想要建模帮助的架构模式，请告诉我们！

## 📚 资源

- [https://icepanel.io/blog/2024-09-24-how-to-diagram-microservices-IcePanel](https://icepanel.io/blog/2024-09-24-how-to-diagram-microservices-IcePanel)
- [https://icepanel.io/blog/2024-10-01-how-to-diagram-events-IcePanel](https://icepanel.io/blog/2024-10-01-how-to-diagram-events-IcePanel)
- [https://martinfowler.com/bliki/DomainDrivenDesign.html](https://martinfowler.com/bliki/DomainDrivenDesign.html)