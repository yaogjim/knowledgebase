Ollama工具调用：7分钟内将AI与任何Python函数集成！

【简介】  
现在我们有了Ollama原生工具，也称为函数调用。这是最新消息：Ollama Python库改进了函数调用功能。这意味着，之前你的代码是这样的函数定义方式，但现在只需要这么少的代码就可以添加你自己的工具或函数，你可以直接在tools变量中指定它。

【为什么需要工具】  
为什么我们需要工具？默认情况下，当你问任何大型语言模型"苹果公司的股票价格是多少"时，它会说"我没有实时数据"。但是我们如何解决这个问题？通过引入工具，当我们问同样的问题"苹果公司的股票价格是多少"时，它会使用函数调用或工具调用，然后用苹果公司的代码启动get_stock_price函数，工具会接收苹果公司的代码并返回苹果公司的股票价格，然后大型语言模型AI会回答"苹果公司的股票价格是235美元"。

【学习目标】  
在本视频结束时，你将学会如何创建自定义工具（可以是你自己的私有工具）并将其与Ollama集成，如何使用异步，以及最后如何使用现有函数。你不会想错过最后的现有函数部分，这是一个高级特性，我认为它会让事情变得更简单。即使你是完全的初学者，你也应该能够一步一步地跟着学习，我会在描述中提供所有代码。

【订阅提示】  
在此之前，我要说我经常在YouTube频道上制作关于人工智能的视频，所以请订阅并点击铃铛图标以保持关注。确保点击喜欢按钮，这样这个视频可以帮助到更多像你一样的人。

【步骤一：创建自定义工具】  
第一步是创建自定义工具。在终端中输入pip install ollama和yahoo_finance，ollama是主要包，yahoo_finance用于获取股票价格，然后按回车键。现在主要包已经安装完成。转到ollama.com并确保根据你的操作系统下载ollama。接下来在终端中输入ollama pull llama2，然后按回车键，这将下载这个大型语言模型或AI。

【代码实现部分】  
接下来让我们创建一个名为app.py的文件并打开它。在文件中首先导入ollama，接着是yahoo_finance，然后是Dict、Any和Callable。现在我们创建一个名为get_stock_price的函数，调用yahoo_finance并传入符号AAPL，然后我们只返回常规市场价格或最新价格，就这么简单，只需要这一个小函数，你甚至可以用自己的函数、工具或应用程序替换它。

【步骤二：与Ollama集成】  
第二步是如何将其与Ollama集成。现在我们要问一个问题："苹果公司当前的股票价格是多少"，并提供可用的函数，即get_stock_price。get_stock_price是我们要使用的唯一函数，这就是工具调用。使用.chat并提供模型名称llama2、角色user以及内容（即提示）。提示就是我们要问的问题，你可以用任何你喜欢的问题替换它。

【工具调用实现】  
这里是工具调用，我们只定义了在这里定义的get_stock_price函数。接下来我们要检查是否有任何工具调用被初始化，基于此我们将获取工具调用函数名称。这个响应会返回函数的名称，所以我们获取函数名称和参数值。这将是AAPL，这将是get_stock_price，最后我们调用该函数get_stock_price，括号中将是AAPL。

【代码运行结果】  
作为快速总结，我们创建了自己的自定义函数，通过在这里只提到工具名称将其与ollama.chat集成，然后我们解析工具名称，获取参数（即AAPL）并运行工具。现在我要在终端中运行这段代码，输入python app.py然后按回车键，这里是响应：调用函数get_stock_price，参数是AAPL。

【AI行为解释】  
这就是AI的工作原理：AI知道苹果公司的股票代码是AAPL，所以它将这个问题从"苹果"转换为"AAPL"。你可以在这里提供任何公司名称，它会根据这个将其转换为代码，并使用该代码运行函数并获取这个值。通过这种方式，你可以像这样将自定义工具或函数添加到Ollama中。

【步骤三：使用异步】  
第三步是如何使用异步。这里有另外两个函数：add_two_numbers和subtract_two_numbers。默认情况下，大型语言模型或AI不会真正进行加法运算，它只是预测这些值。所以它不知道如何加数字或减数字，因此我们要创建用于加法和减法的函数。和之前一样，我们在tools变量中传递这两个函数。

【异步实现】  
要将其转换为异步，我们只需使用asyncio库，在主函数中添加async，初始化异步客户端，最后使用async来运行。这些都是很小的改动，我们要问的问题是"3+1等于多少"。现在我要运行这段代码python async_tools，问题是"3+1等于多少"，它调用了名为add_two_numbers的函数，参数是A=1和B=3，函数输出是4，这很好。

【最后一步：使用现有函数】  
最后一步是使用现有函数。这里是现有函数requests。Python默认有许多不同的函数，你甚至可以从Python包中安装许多不同的函数。你可以直接在tools中使用这些函数。requests.request是一个函数，我们可以直接在这里定义它，这是添加工具最简单的方式之一，这将使事情变得更容易，而不是我们创建自己的工具，我们可以在Ollama中使用所有现有的工具。

【实际应用示例】  
在这里定义它，这个requests.request的功能是访问URL并抓取数据并返回值，这就是这个工具的功能。我们只是导入它并在这里添加工具。和之前一样，我们要问我们的问题，问题是"获取ollama.com网页"或者可以是"获取m.v网页"（那是我的网页），然后和之前一样，我们获取函数名称、获取URL和获取方法（方法可能是get方法），最后我们打印响应，就这样。

【结语】  
所以我们导入了那个包，在这里定义它，并使用函数调用运行那个函数。现在我要在终端中运行这段代码，这里是输出：这是HTML代码，但你可以使用其他工具将其转换为Markdown，但你可以清楚地看到它能够读取我网页的所有内容，这非常酷。你甚至可以在这里添加更多URL，使其爬取多个页面，那将非常酷。现在我就到这里，让你自己尝试一下，在下面的评论中让我知道你对此的看法。考虑到你已经喜欢上了Ollama，我已经制作了一个关于Ollama的视频，我会把链接放在描述中和屏幕上，我强烈建议你观看。所以请点击它，我们那里见。